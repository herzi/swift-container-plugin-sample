on:
  push: {}

jobs:
  deploy:
    runs-on: ubuntu-latest
    container: swift:6.2

    steps:
#      - name: 🔄 Restore Static Linux Swift SDK
#        id: cache-sdk
#        uses: actions/cache@v4
#        with:
#          path: |
#            /root/.swiftpm
#          key: ${{ runner.os }}-dot_swiftpm-${{ github.sha }}
#          restore-keys: |
#            ${{ runner.os }}-dot_swiftpm-

      - name: 🧩 Install Static Linux Swift SDK
#        if: steps.cache-sdk.outputs.cache-hit != 'true'
        run: |
          swift sdk install https://download.swift.org/swift-6.2-release/static-sdk/swift-6.2-RELEASE/swift-6.2-RELEASE_static-linux-0.0.1.artifactbundle.tar.gz --checksum d2225840e592389ca517bbf71652f7003dbf45ac35d1e57d98b9250368769378

      - name: ⬇️ Checkout Code
        uses: actions/checkout@v5

      # restore source files and intermediate products with old timestamps
#      - name: 🔄 Restore Build Cache
#        uses: actions/cache@v4
#        with:
#          path: |
#            .build
#            Sources
#          key: ${{ runner.os }}-build-${{ github.sha }}
#          restore-keys: |
#            ${{ runner.os }}-build-

      # overwrite cached files that have changes, remove stale files
#      - name: 🧹 Remove Restored, Stale Files, Final Checkout
#        run: |
#          git config --global --add safe.directory ${GITHUB_WORKSPACE}
#          git clean -fd
#          git checkout -f

#      - name: 🧐 Inspect `.build` Folder
#        run: |
#          ls -l .build || true

      - name: 🚛 Build and Publish Container Image
        run: |
          sh Scripts/build-container.sh

